"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}jQuery(function(){var s,u;s=window.jQuery,u=window.Puock,new(function(){function t(){_classCallCheck(this,t),_defineProperty(this,"data",null),this.data={chatList:[]},this.init(),this.onAiSubmit(),this.onClearHistory(),this.onCopyChat()}return _createClass(t,[{key:"init",value:function(){s(".chat-btn-init").remove(),s(".chat-btn-box").removeClass("d-none")}},{key:"onAiSubmit",value:function(){var c=this;s(".chat-input").on("keydown",function(t){t.ctrlKey&&13===t.which&&s(".chat-submit").click()}),s(".chat-submit").on("click",function(t){var e,n,r,o,i=s(t.currentTarget),t=s(".chat-input"),a=s.trim(t.val());""===a?u.toast("请先输入内容"):(c.putMsg({ai:!1,avatar:aiMetaInfo.userAvatar,content:a}),e=c.putMsg({ai:!0,avatar:aiMetaInfo.aiAvatar,content:"",load:!0}),i.attr("disabled",!0),t.val(""),n=s("#"+e.id),r=n.find(".content-box"),o=function(){n.find(".cursor-blink-after").removeClass("cursor-blink-after"),i.attr("disabled",!1)},s.post(aiMetaInfo.url,{text:a},function(t){e.content=t,r.html(c.parseContent(t)),u.initCodeHighlight("#"+e.id),o(),s("html,body").stop().animate({scrollTop:s(document).height()},200)}).fail(function(t){o(),console.error(t),r.html("<code>请求异常</code>")}))})}},{key:"putMsg",value:function(t){var e="chat-"+(new Date).getTime()+""+Math.floor(1e3*Math.random())+"",n=_objectSpread({id:e},t),t=(this.data.chatList.push(n),'<div id="'.concat(e,'" class="chat-item is-').concat(t.ai?"ai":"user",'">\n                                <div class="row">\n                                    <div class="col-auto">\n                                        <img src="').concat(t.avatar,'" class="avatar md-avatar" alt="avatar">\n                                    </div>\n                                    <div class="col">\n                                        <div class="fs14 content-box ').concat(t.ai?"cursor-blink-after":"",'">').concat(this.parseContent(t.content),'</div>\n                                        <div class="d-flex fs14 align-items-center mt-2">\n                                            <div class="text-muted fs12 primary-text-hover pk-copy" data-cp-title="对话信息" data-cp-func="puockAiChatCopy" data-id="').concat(e,'"><i class="fa-regular fa-copy mr-1"></i>复制</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>'));return s(".chats").append(t),u.initCodeHighlight("#"+e),n}},{key:"onClearHistory",value:function(){s(".chat-clear-history").on("click",function(){var t,e=null!=(t=s(".chats").find(".chat-template").prop("outerHTML"))?t:"";layer.confirm("确定要清空历史记录吗？",{btn:["确定","取消"]},function(t){layer.close(t),s(".chats").html(e)})})}},{key:"onCopyChat",value:function(){var n=this;window.puockAiChatCopy=function(t){var e=t.data("id"),t=n.data.chatList.find(function(t){return t.id===e?t:null});return t?t.content:""}}},{key:"parseContent",value:function(t){return marked.parse(t,{breaks:!0})}}]),t}())});